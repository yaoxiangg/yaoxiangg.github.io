<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cubes Factory</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/gsap.min.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@500&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            height: 100vh;
            font-family: 'Ubuntu', sans-serif;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        .title {
            position: absolute;
            margin-left: 20px;
            color: white;
        }

        @media (min-width: 600px) {
            .menu-btns {
                position: absolute;
                top: 80px;
            }
            .mobile-menu-btns {
                display: none;
            }
        }

        @media (max-width: 600px) {
            .mobile-menu-btns {
                position: absolute;
                top: 80px;
                width: 100%;
                text-align: center;
            }
            .menu-btns {
                display: none;
            }
        }

        .btn {
            background: #ffffff;
            padding: 10px 20px;
            min-width: 100px;
            margin-bottom: 4px;
            cursor: pointer;
        }

        .btn:active, .btn:hover {
            background: #eba601;
        }

        .btn-round {
            border-radius: 5px;
            background: #ffffff;
            display: inline-flex;
            margin: 5px;
            padding: 5px 10px;
        }

        .btn-round:active, .btn-round:hover {
            background: #eba601;
        }

    </style>
</head>

<body>
    <h1 class="title">Genique</h1>
    <div class="menu-btns">
        <div class="btn" onclick="showImage('cube')">CUBE</div>
        <div class="btn" onclick="showImage('snorlax')">SNORLAX</div>
        <div class="btn" onclick="showImage('dratini')">DRATINI</div>
        <div class="btn" onclick="showImage('wallx')">WALL X</div>
        <div class="btn" onclick="showImage('wally')">WALL Y</div>
        <div class="btn" onclick="showImage('wallz')">WALL Z</div>
        <div class="btn" onclick="showImage('weird1')">WEIRD 1</div>
    </div>
    <div class="mobile-menu-btns">
        <div class="btn-round" onclick="showImage('cube')">CUBE</div>
        <div class="btn-round" onclick="showImage('snorlax')">SNORLAX</div>
        <div class="btn-round" onclick="showImage('dratini')">DRATINI</div>
        <div class="btn-round" onclick="showImage('wallx')">WALL X</div>
        <div class="btn-round" onclick="showImage('wally')">WALL Y</div>
        <div class="btn-round" onclick="showImage('wallz')">WALL Z</div>
        <div class="btn-round" onclick="showImage('weird1')">WEIRD 1</div>
    </div>

    <script src="./assets/js/blueprint.js"></script>
    <script>

        // Global Vars
        var currentTimeout = [];
        var backgroundColor = 0x333333;
        var planeColor = 0x80cbc4;
        var cubeGaps = 1.05;

        var imagey_grid = [];
        var imagex_grid = [];
        var imagez_grid = [];

        var random_color_1 = Math.floor(Math.random()*16777215);
        var random_color_2 = Math.floor(Math.random()*16777215);
        var random_color_3 = Math.floor(Math.random()*16777215);
        var random_color_4 = Math.floor(Math.random()*16777215);
        var random_color_5 = Math.floor(Math.random()*16777215);

        for (var x = 0; x < 10; x++) {
            for (var y = 0; y < 10; y++) {
                imagex_grid.push([x,y,0,random_color_3]); // wall at x & y
                imagey_grid.push([0,x,y,random_color_4]); // wall at y & z
                imagez_grid.push([y,0,x,random_color_5]); // wall at z & x
            }
        }

        var imagex1_grid = [[0,0,0,random_color_1],[1,0,0,random_color_1],[2,0,0,random_color_1],[3,0,0,random_color_1],[4,0,0,random_color_1],[5,0,0,random_color_1],[6,0,0,random_color_1],[7,0,0,random_color_1],[8,0,0,random_color_1],[9,0,0,random_color_1],[10,0,0,random_color_1]];

        var imagez1_grid = [[0,0,0,random_color_2],[0,0,1,random_color_2],[0,0,2,random_color_2],[0,0,3,random_color_2],[0,0,4,random_color_2],[0,0,5,random_color_2],[0,0,6,random_color_2],[0,0,7,random_color_2],[0,0,8,random_color_2],[0,0,9,random_color_2],[0,0,10,random_color_2],[0,1,10,random_color_2],[0,1,9,random_color_2],[0,1,8,random_color_2],[0,1,7,random_color_2],[0,1,6,random_color_2],[0,1,5,random_color_2],[0,1,4,random_color_2],[0,1,3,random_color_2]];

        var image_gengar_grid = [
            // layer1
            [3,0,5,0x68507b],
            [3,0,6,0x68507b],
            [4,0,5,0x68507b],
            [4,0,6,0x68507b],
            [8,0,5,0x68507b],
            [8,0,6,0x68507b],
            [9,0,5,0x68507b],
            [9,0,6,0x68507b],

            [3,1,5,0x68507b],
            [4,1,5,0x68507b],
            [8,1,5,0x68507b],
            [9,1,5,0x68507b],
            [5,1,6,0x68507b],
            [6,1,6,0x68507b],
            [7,1,6,0x68507b],
            [5,1,5,0x68507b],
            [6,1,5,0x68507b],
            [7,1,5,0x68507b],
            [4,1,4,0x68507b],
            [5,1,4,0x68507b],
            [6,1,4,0x68507b],
            [7,1,4,0x68507b],
            [8,1,4,0x68507b],

            [3,2,4,0x68507b],
            [4,2,4,0x68507b],
            [5,2,4,0x68507b],
            [6,2,4,0x68507b],
            [7,2,4,0x68507b],
            [8,2,4,0x68507b],
            [9,2,4,0x68507b],
            [3,2,5,0x68507b],
            [4,2,5,0x68507b],
            [5,2,5,0x68507b],
            [6,2,5,0x68507b],
            [7,2,5,0x68507b],
            [8,2,5,0x68507b],
            [9,2,5,0x68507b],
            [3,2,6,0x68507b],
            [4,2,6,0x68507b],
            [5,2,6,0x68507b],
            [6,2,6,0x68507b],
            [7,2,6,0x68507b],
            [8,2,6,0x68507b],
            [9,2,6,0x68507b],
            [4,2,7,0x68507b],
            [5,2,7,0x68507b],
            [6,2,7,0x68507b],
            [7,2,7,0x68507b],
            [8,2,7,0x68507b],
            [10,2,4,0x68507b],
            [2,2,4,0x68507b],

            //layer3
            [3,3,3,0x68507b],
            [4,3,3,0x68507b],
            [5,3,3,0x68507b],
            [6,3,3,0x68507b],
            [7,3,3,0x68507b],
            [8,3,3,0x68507b],
            [9,3,3,0x68507b],
            [3,3,4,0x68507b],
            [4,3,4,0x68507b],
            [5,3,4,0x68507b],
            [6,3,4,0x68507b],
            [7,3,4,0x68507b],
            [8,3,4,0x68507b],
            [9,3,4,0x68507b],
            [3,3,5,0x68507b],
            [4,3,5,0x68507b],
            [5,3,5,0x68507b],
            [6,3,5,0x68507b],
            [7,3,5,0x68507b],
            [8,3,5,0x68507b],
            [9,3,5,0x68507b],
            [2,3,6,0x68507b],
            [3,3,6,0x68507b],
            [4,3,6,0x68507b],
            [5,3,6,0x68507b],
            [6,3,6,0x68507b],
            [7,3,6,0x68507b],
            [8,3,6,0x68507b],
            [9,3,6,0x68507b],
            [10,3,6,0x68507b],
            [4,3,7,0x68507b],
            [5,3,7,0x68507b],
            [6,3,7,0x68507b],
            [7,3,7,0x68507b],
            [8,3,7,0x68507b],
            [9,3,7,0x68507b],
            [10,3,4,0x68507b],
            [10,3,5,0x68507b],
            [2,3,4,0x68507b],
            [2,3,5,0x68507b],
            [5,3,8,0x68507b],
            [6,3,8,0x68507b],
            [7,3,8,0x68507b],

            //
            [2,4,3,0x68507b],
            [3,4,3,0x68507b],
            [4,4,3,0x68507b],
            [5,4,3,0x68507b],
            [6,4,3,0x68507b],
            [7,4,3,0x68507b],
            [8,4,3,0x68507b],
            [9,4,3,0x68507b],
            [10,4,3,0x68507b],
            [2,4,4,0x68507b],
            [3,4,4,0x68507b],
            [4,4,4,0x68507b],
            [5,4,4,0x68507b],
            [6,4,4,0x68507b],
            [7,4,4,0x68507b],
            [8,4,4,0x68507b],
            [9,4,4,0x68507b],
            [10,4,4,0x68507b],
            [2,4,4,0x68507b],
            [3,4,4,0x68507b],
            [4,4,4,0x68507b],
            [5,4,4,0x68507b],
            [6,4,4,0x68507b],
            [7,4,4,0x68507b],
            [8,4,4,0x68507b],
            [9,4,4,0x68507b],
            [10,4,5,0x68507b],
            [2,4,5,0x68507b],
            [3,4,5,0x68507b],
            [4,4,5,0x68507b],
            [5,4,5,0x68507b],
            [6,4,5,0x68507b],
            [7,4,5,0x68507b],
            [8,4,5,0x68507b],
            [9,4,5,0x68507b],
            [10,4,5,0x68507b],
            [2,4,6,0x68507b],
            [3,4,6,0x68507b],
            [4,4,6,0x68507b],
            [5,4,6,0x68507b],
            [6,4,6,0x68507b],
            [7,4,6,0x68507b],
            [8,4,6,0x68507b],
            [9,4,6,0x68507b],
            [10,4,6,0x68507b],
            [2,4,7,0x68507b],
            [3,4,7,0x68507b],
            [4,4,7,0x68507b],
            [5,4,7,0x68507b],
            [6,4,7,0x68507b],
            [7,4,7,0x68507b],
            [8,4,7,0x68507b],
            [9,4,7,0x68507b],
            [10,4,7,0x68507b],

            [2,5,3,0x68507b],
            [3,5,3,0x68507b],
            [4,5,3,0x68507b],
            [5,5,3,0x68507b],
            [6,5,3,0x68507b],
            [7,5,3,0x68507b],
            [8,5,3,0x68507b],
            [9,5,3,0x68507b],
            [10,5,3,0x68507b],
            [2,5,4,0x68507b],
            [3,5,4,0x68507b],
            [4,5,4,0x68507b],
            [5,5,4,0x68507b],
            [6,5,4,0x68507b],
            [7,5,4,0x68507b],
            [8,5,4,0x68507b],
            [9,5,4,0x68507b],
            [10,5,4,0x68507b],
            [2,5,4,0x68507b],
            [3,5,4,0x68507b],
            [4,5,4,0x68507b],
            [5,5,4,0x68507b],
            [6,5,4,0x68507b],
            [7,5,4,0x68507b],
            [8,5,4,0x68507b],
            [9,5,4,0x68507b],
            [10,5,5,0x68507b],
            [2,5,5,0x68507b],
            [3,5,5,0x68507b],
            [4,5,5,0x68507b],
            [5,5,5,0x68507b],
            [6,5,5,0x68507b],
            [7,5,5,0x68507b],
            [8,5,5,0x68507b],
            [9,5,5,0x68507b],
            [10,5,5,0x68507b],
            [2,5,6,0x68507b],
            [3,5,6,0x68507b],
            [4,5,6,0x68507b],
            [5,5,6,0x68507b],
            [6,5,6,0x68507b],
            [7,5,6,0x68507b],
            [8,5,6,0x68507b],
            [9,5,6,0x68507b],
            [10,5,6,0x68507b],
            [2,5,7,0x68507b],
            [3,5,7,0x68507b],
            [4,5,7,0x68507b],
            [5,5,7,0x68507b],
            [6,5,7,0x68507b],
            [7,5,7,0x68507b],
            [8,5,7,0x68507b],
            [9,5,7,0x68507b],
            [10,5,7,0x68507b],

            [2,6,3,0x68507b],
            [3,6,3,0x68507b],
            [4,6,3,0x68507b],
            [5,6,3,0x68507b],
            [6,6,3,0x68507b],
            [7,6,3,0x68507b],
            [8,6,3,0x68507b],
            [9,6,3,0x68507b],
            [10,6,3,0x68507b],
            [2,6,4,0x68507b],
            [3,6,4,0x68507b],
            [4,6,4,0x68507b],
            [5,6,4,0x68507b],
            [6,6,4,0x68507b],
            [7,6,4,0x68507b],
            [8,6,4,0x68507b],
            [9,6,4,0x68507b],
            [10,6,4,0x68507b],
            [2,6,4,0x68507b],
            [3,6,4,0x68507b],
            [4,6,4,0x68507b],
            [5,6,4,0x68507b],
            [6,6,4,0x68507b],
            [7,6,4,0x68507b],
            [8,6,4,0x68507b],
            [9,6,4,0x68507b],
            [10,6,5,0x68507b],
            [2,6,5,0x68507b],
            [3,6,5,0x68507b],
            [4,6,5,0x68507b],
            [5,6,5,0x68507b],
            [6,6,5,0x68507b],
            [7,6,5,0x68507b],
            [8,6,5,0x68507b],
            [9,6,5,0x68507b],
            [10,6,5,0x68507b],
            [2,6,6,0x68507b],
            [3,6,6,0x68507b],
            [4,6,6,0x68507b],
            [5,6,6,0x68507b],
            [6,6,6,0x68507b],
            [7,6,6,0x68507b],
            [8,6,6,0x68507b],
            [9,6,6,0x68507b],
            [10,6,6,0x68507b],
            [2,6,7,0x68507b],
            [3,6,7,0xffffff],
            [4,6,7,0xffffff],
            [5,6,7,0x68507b],
            [6,6,7,0x68507b],
            [7,6,7,0x68507b],
            [8,6,7,0xffffff],
            [9,6,7,0xffffff],
            [10,6,7,0x68507b],

            [2,7,3,0x68507b],
            [3,7,3,0x68507b],
            [4,7,3,0x68507b],
            [5,7,3,0x68507b],
            [6,7,3,0x68507b],
            [7,7,3,0x68507b],
            [8,7,3,0x68507b],
            [9,7,3,0x68507b],
            [10,7,3,0x68507b],
            [2,7,4,0x68507b],
            [3,7,4,0x68507b],
            [4,7,4,0x68507b],
            [5,7,4,0x68507b],
            [6,7,4,0x68507b],
            [7,7,4,0x68507b],
            [8,7,4,0x68507b],
            [9,7,4,0x68507b],
            [10,7,4,0x68507b],
            [2,7,4,0x68507b],
            [3,7,4,0x68507b],
            [4,7,4,0x68507b],
            [5,7,4,0x68507b],
            [6,7,4,0x68507b],
            [7,7,4,0x68507b],
            [8,7,4,0x68507b],
            [9,7,4,0x68507b],
            [10,7,5,0x68507b],
            [2,7,5,0x68507b],
            [3,7,5,0x68507b],
            [4,7,5,0x68507b],
            [5,7,5,0x68507b],
            [6,7,5,0x68507b],
            [7,7,5,0x68507b],
            [8,7,5,0x68507b],
            [9,7,5,0x68507b],
            [10,7,5,0x68507b],
            [2,7,6,0x68507b],
            [3,7,6,0x68507b],
            [4,7,6,0x68507b],
            [5,7,6,0x68507b],
            [6,7,6,0x68507b],
            [7,7,6,0x68507b],
            [8,7,6,0x68507b],
            [9,7,6,0x68507b],
            [10,7,6,0x68507b],
            [2,7,7,0x68507b],
            [3,7,7,0xffffff],
            [4,7,7,0xffffff],
            [5,7,7,0x68507b],
            [6,7,7,0x68507b],
            [7,7,7,0x68507b],
            [8,7,7,0xffffff],
            [9,7,7,0xffffff],
            [10,7,7,0x68507b],

            [2,8,3,0x68507b],
            [3,8,3,0x68507b],
            [4,8,3,0x68507b],
            [5,8,3,0x68507b],
            [6,8,3,0x68507b],
            [7,8,3,0x68507b],
            [8,8,3,0x68507b],
            [9,8,3,0x68507b],
            [10,8,3,0x68507b],
            [2,8,4,0x68507b],
            [3,8,4,0x68507b],
            [4,8,4,0x68507b],
            [5,8,4,0x68507b],
            [6,8,4,0x68507b],
            [7,8,4,0x68507b],
            [8,8,4,0x68507b],
            [9,8,4,0x68507b],
            [10,8,4,0x68507b],
            [2,8,4,0x68507b],
            [3,8,4,0x68507b],
            [4,8,4,0x68507b],
            [5,8,4,0x68507b],
            [6,8,4,0x68507b],
            [7,8,4,0x68507b],
            [8,8,4,0x68507b],
            [9,8,4,0x68507b],
            [10,8,5,0x68507b],
            [2,8,5,0x68507b],
            [3,8,5,0x68507b],
            [4,8,5,0x68507b],
            [5,8,5,0x68507b],
            [6,8,5,0x68507b],
            [7,8,5,0x68507b],
            [8,8,5,0x68507b],
            [9,8,5,0x68507b],
            [10,8,5,0x68507b],
            [2,8,6,0x68507b],
            [3,8,6,0x68507b],
            [4,8,6,0x68507b],
            [5,8,6,0x68507b],
            [6,8,6,0x68507b],
            [7,8,6,0x68507b],
            [8,8,6,0x68507b],
            [9,8,6,0x68507b],
            [10,8,6,0x68507b],
            [2,8,7,0x68507b],
            [3,8,7,0xffffff],
            [4,8,7,0xffffff],
            [5,8,7,0x68507b],
            [6,8,7,0x68507b],
            [7,8,7,0x68507b],
            [8,8,7,0xffffff],
            [9,8,7,0xffffff],
            [10,8,7,0x68507b],

            [2,9,3,0x68507b],
            [3,9,3,0x68507b],
            [4,9,3,0x68507b],
            [5,9,3,0x68507b],
            [6,9,3,0x68507b],
            [7,9,3,0x68507b],
            [8,9,3,0x68507b],
            [9,9,3,0x68507b],
            [10,9,3,0x68507b],
            [2,9,4,0x68507b],
            [3,9,4,0x68507b],
            [4,9,4,0x68507b],
            [5,9,4,0x68507b],
            [6,9,4,0x68507b],
            [7,9,4,0x68507b],
            [8,9,4,0x68507b],
            [9,9,4,0x68507b],
            [10,9,4,0x68507b],
            [2,9,4,0x68507b],
            [3,9,4,0x68507b],
            [4,9,4,0x68507b],
            [5,9,4,0x68507b],
            [6,9,4,0x68507b],
            [7,9,4,0x68507b],
            [8,9,4,0x68507b],
            [9,9,4,0x68507b],
            [10,9,5,0x68507b],
            [2,9,5,0x68507b],
            [3,9,5,0x68507b],
            [4,9,5,0x68507b],
            [5,9,5,0x68507b],
            [6,9,5,0x68507b],
            [7,9,5,0x68507b],
            [8,9,5,0x68507b],
            [9,9,5,0x68507b],
            [10,9,5,0x68507b],
            [2,9,6,0x68507b],
            [3,9,6,0x68507b],
            [4,9,6,0x68507b],
            [5,9,6,0x68507b],
            [6,9,6,0x68507b],
            [7,9,6,0x68507b],
            [8,9,6,0x68507b],
            [9,9,6,0x68507b],
            [10,9,6,0x68507b],
            [2,9,7,0x68507b],
            [3,9,7,0x68507b],
            [4,9,7,0x68507b],
            [5,9,7,0x68507b],
            [6,9,7,0x68507b],
            [7,9,7,0x68507b],
            [8,9,7,0x68507b],
            [9,9,7,0x68507b],
            [10,9,7,0x68507b],

            [2,10,3,0x68507b],
            [3,10,3,0x68507b],
            [4,10,3,0x68507b],
            [5,10,3,0x68507b],
            [6,10,3,0x68507b],
            [7,10,3,0x68507b],
            [8,10,3,0x68507b],
            [9,10,3,0x68507b],
            [10,10,3,0x68507b],
            [2,10,4,0x68507b],
            [3,10,4,0x68507b],
            [4,10,4,0x68507b],
            [5,10,4,0x68507b],
            [6,10,4,0x68507b],
            [7,10,4,0x68507b],
            [8,10,4,0x68507b],
            [9,10,4,0x68507b],
            [10,10,4,0x68507b],
            [2,10,4,0x68507b],
            [3,10,4,0x68507b],
            [4,10,4,0x68507b],
            [5,10,4,0x68507b],
            [6,10,4,0x68507b],
            [7,10,4,0x68507b],
            [8,10,4,0x68507b],
            [9,10,4,0x68507b],
            [10,10,5,0x68507b],
            [2,10,5,0x68507b],
            [3,10,5,0x68507b],
            [4,10,5,0x68507b],
            [5,10,5,0x68507b],
            [6,10,5,0x68507b],
            [7,10,5,0x68507b],
            [8,10,5,0x68507b],
            [9,10,5,0x68507b],
            [10,10,5,0x68507b],
            [2,10,6,0x68507b],
            [3,10,6,0x68507b],
            [4,10,6,0x68507b],
            [5,10,6,0x68507b],
            [6,10,6,0x68507b],
            [7,10,6,0x68507b],
            [8,10,6,0x68507b],
            [9,10,6,0x68507b],
            [10,10,6,0x68507b],
            [2,10,7,0x68507b],
            [3,10,7,0x68507b],
            [4,10,7,0x68507b],
            [5,10,7,0x68507b],
            [6,10,7,0x68507b],
            [7,10,7,0x68507b],
            [8,10,7,0x68507b],
            [9,10,7,0x68507b],
            [10,10,7,0x68507b],
        ];

        var full_cube = [];
        var randomColor = Math.floor(Math.random()*16777215);
        console.log("Random Color: 0x" + randomColor.toString(16));
        for(var j = 0; j < 10; j++){
            for(var i = 0; i < 10; i++){
                for(var k = 0; k < 10; k++){
                    full_cube.push([i,j,k,randomColor]);
                }
            }
        }
        var g_grids = [snorlax_grid,dratini_grid,imagex_grid,imagey_grid,imagez_grid,imagex1_grid,imagez1_grid,image_gengar_grid,full_cube];
        var scene = new THREE.Scene();

        // Helper Functions
        function showImage(image_name) {
            var tl = gsap.exportRoot();
            for (var i = 0; i < currentTimeout.length; i++) {
                clearTimeout(currentTimeout[i]);
            }
            currentTimeout = [];
            TweenLite.to(tl, 0, {timeScale:0, onComplete:function(){ 
                tl.kill();
                if (image_name == "snorlax") { drawImage(g_grids[0]); }
                if (image_name == "dratini") { drawImage(g_grids[1]); }
                if (image_name == "wallx") { drawImage(g_grids[2]); }
                if (image_name == "wally") { drawImage(g_grids[3]); }
                if (image_name == "wallz") { drawImage(g_grids[4]); }
                if (image_name == "weird1") { drawImage(g_grids[7]); }
                if (image_name == "cube") { drawImage(g_grids[8]); }
                cycleImage(0);
            }});
            
        }
        function drawImage(image_grid) {
            var idx = 0;
            var to_remove = [];
            scene.traverseVisible( function ( object ) {
                var geometry = object.geometry;
                if ( object instanceof THREE.Mesh ) {
                    if (geometry.type == 'BoxGeometry') {
                        if (idx >= image_grid.length) {
                            if (object.type !== 'Scene') {
                                to_remove.push(object);
                            }
                        } else {
                            if (idx <= image_grid.length) {
                                moveCube(object, image_grid[idx][0], image_grid[idx][1], image_grid[idx][2], image_grid[idx][3]);
                            }
                            idx += 1;
                        }
                    }
                }
            });

            for (x in to_remove) {
                removeCube(to_remove[x]);
            }

            var to_add = image_grid.length - idx;
            for (var c = 0; c < to_add; c++) 
                addCube(image_grid[idx+c][0], image_grid[idx+c][1], image_grid[idx+c][2], image_grid[idx+c][3]);
        }

        function removeCube(cube) {
            this.tl = new TimelineMax();
            this.tl.to(cube.position, 1, {y: cube.position.y*cubeGaps+60, ease: Expo.easeOut});
            this.tl.to(cube.material, 1, { transparent: true, opacity: 0, ease: Expo.easeOut}, "-=1");
            var removetimeout = setTimeout(function() { scene.remove(cube); }, 1500);
            currentTimeout.push(removetimeout);
        }

        function addCube(x, y, z, color) {
            var cube = drawCube(x,y+60,z, color);
            moveCube(cube, x, y, z, color);
        }

        function moveCube(cube, x, y, z, color) {
            var color_val = new THREE.Color(color);
            this.tl = new TimelineMax();
            var duration = Math.min(2, 1.4*(1+(x/5.0+y/5.0+z/5.0)));
            this.tl.to(cube.material, 0, { transparent: true, opacity: 1, ease: Expo.easeOut});
            this.tl.to(cube.position, duration, {x: (x-5)*cubeGaps, y: y*cubeGaps, z: (z-5)*cubeGaps, ease: Expo.easeOut});
            this.tl.to(cube.material.color, duration, {r: color_val.r, g: color_val.g, b: color_val.b, ease: Expo.easeOut}, "-=2");
        }

        function drawCube(x, y, z, color) {
            var geometry = new THREE.BoxGeometry(1, 1, 1);  
            var material = new THREE.MeshPhongMaterial({color: color});
            var mesh = new THREE.Mesh(geometry, material);
            mesh.position.x = (x-5)*cubeGaps;
            mesh.position.y = y*cubeGaps;
            mesh.position.z = (z-5)*cubeGaps;
            mesh.castShadow = true; //default is false
            mesh.receiveShadow = false; //default
            scene.add(mesh);
            mesh.cursor = 'pointer';
            return mesh;
        }

        function drawPlane(x, y, z, color) {
            const geometry = new THREE.PlaneGeometry(20,20);
            geometry.rotateX(-Math.PI * 0.5);
            const material = new THREE.MeshLambertMaterial( {color: color, side: THREE.DoubleSide} );
            const plane = new THREE.Mesh( geometry, material );
            plane.position.y = -cubeGaps;
            plane.position.x = 0;
            plane.position.z = 0;
            plane.receiveShadow = true;
            scene.add(plane);
        }

        const aspect = window.innerWidth / window.innerHeight;
        if (aspect > 1)
            width = 60*aspect;
        else 
            width = 40;
        const height = width / aspect;

        // Setup Camera
        var camera = new THREE.OrthographicCamera(
            width / -2, // left
            width / 2, // right
            height / 2, // top
            height / -2, // bottom
            0, // near plane
            200 // far plane
        );

        camera.position.set(50, 50, 50);
        camera.lookAt(0, 0, 0);

        // Setup Renderer
        var renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.render(scene, camera);
        renderer.setClearColor(backgroundColor); 

        // Setup Lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.6, 100);
        dirLight.position.set(10, 40, 20);
        dirLight.castShadow = true; // default false
        dirLight.shadow.mapSize.width = 512*2; // default
        dirLight.shadow.mapSize.height = 512*2; // default
        dirLight.shadow.camera.near = 0; // default
        dirLight.shadow.camera.far = 100; // default
        dirLight.shadow.camera.left = -20;
        dirLight.shadow.camera.right = 20;
        dirLight.shadow.camera.top = 25;
        dirLight.shadow.camera.bottom = -30;
        scene.add(dirLight);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enablePan = false;
        controls.maxPolarAngle  = Math.PI / 2 - 0.1;
        controls.minPolarAngle  = Math.PI / 8;
        controls.maxZoom = Math.PI/ 4;
        controls.minZoom = Math.PI/ 8;
        controls.update();

        // Show Helpers
        // const axesHelper = new THREE.AxesHelper( 5 );
        // scene.add(axesHelper);
        // const helper = new THREE.CameraHelper( dirLight.shadow.camera );
        // scene.add( helper );

        // Append to DOM
        document.body.appendChild(renderer.domElement);

        var render = function(){
            requestAnimationFrame(render);
            renderer.render(scene,camera);
        };
        render();

        // Detect Intersects
        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2();
        var is_moving_camera = false;
        function onMouseDown(event) {
            is_moving_camera = true;
            old_x = (event.clientX / window.innerWidth) * 2 - 1;
            old_y = (event.clientY / window.innerHeight) * 2 - 1;
        }

        function onTouchStart(event) {
            is_moving_camera = true;
            mouse.x = (event.touches[0].clientX  / window.innerWidth) * 2 - 1;
            mouse.y = (event.touches[0].clientY  / window.innerHeight) * 2 - 1;
            old_x = mouse.x;
            old_y = mouse.y;
        }

        function onMouseUp(event) {
            is_moving_camera = false;
        }

        function onMouseMove(event) {
            event.preventDefault();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
            processMouse(mouse.x, mouse.y);
            old_x = (event.clientX / window.innerWidth) * 2 - 1;
            old_y = (event.clientY / window.innerHeight) * 2 - 1;
        }

        function onTouchMove(event) {
            mouse.x = (event.touches[0].clientX  / window.innerWidth) * 2 - 1;
            mouse.y = (event.touches[0].clientY  / window.innerHeight) * 2 - 1;
            processMouse(mouse.x, mouse.y);
            old_x = mouse.x;
            old_y = mouse.y;
        }


        var old_delta = 0;
        function processMouse(clientX, clientY) {
            raycaster.setFromCamera(mouse, camera);
            var intersects = raycaster.intersectObjects(scene.children, true);

            for(var i = 0; i < intersects.length; i++) {
                if (intersects[i].object.geometry.type == 'BoxGeometry') {
                    this.tl = new TimelineMax();
                    this.tl.to(intersects[i].object.scale, .5, {x: .5, y: .5, z: .5,ease: Expo.easeOut});
                    this.tl.to(intersects[i].object.rotation, .5, {y: Math.PI*.5, ease: Expo.easeOut});
                    this.tl.to(intersects[i].object.scale, .5, {x: 1, y: 1, z: 1,ease: Expo.easeOut});
                }
                return;
            }
        }
        window.addEventListener('touchstart', onTouchStart);
        window.addEventListener('touchend', onMouseUp);
        window.addEventListener('touchmove', onTouchMove);
        window.addEventListener('mousedown', onMouseDown);
        window.addEventListener('mouseup', onMouseUp);
        window.addEventListener('mousemove', onMouseMove);
        window.addEventListener('resize', () => {
            renderer.setSize(window.innerWidth,window.innerHeight);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
        });


        // Script after Init

        // Draw Initial Plane and Cubes
        drawPlane(0,0,0,planeColor);

        function cycleImage(img) {
            var timeout_ms = 4000;
            if (img == -1) {
                timeout_ms = 0;
                img = 0;
            } 
            var timeout = setTimeout(function() {
                drawImage(g_grids[img]) 
                cycleImage((img + 1) % g_grids.length);
            }, timeout_ms);
            currentTimeout.push(timeout);
        }
        
        cycleImage(-1);

    </script>
</body>
</html>
